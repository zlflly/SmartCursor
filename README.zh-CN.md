# SmartCursor

英文版： [README.md](README.md)

在 C/C++ 编辑时，根据光标上下文自动切换输入法。

## 1. 目前实现的功能

- 支持系统：Windows（依赖 `im-select.exe`）。
- 支持语言：`c`、`cpp`（可通过 `imeContextSwitcher.enabledLanguageIds` 配置）。
- 上下文切换规则：
  - 在 `//` 注释中切到中文输入法。
  - 在 `/* ... */` 注释中切到中文输入法。
  - 在双引号字符串 `"..."` 中切到中文输入法。
  - 其他位置切到英文输入法。
- 提供开关项：可分别关闭行注释、块注释、双引号字符串的自动切换。
- 默认输入法编码：中文 `2052`，英文 `1033`（可配置）。
- 新增：编辑器失焦（如切到终端、菜单、窗口外）时自动切到中文输入法（可配置）。
- 新增：启动时可读取当前输入法并将其作为“英文目标输入法”，降低初始状态导致的切换失败。

## 2. 存在的问题

- 仅支持 Windows，其他平台未实现。
- 依赖 `im-select.exe`，文件缺失或路径错误时无法切换。
- 当前语言默认只覆盖 C/C++，其他语言需要手动加入配置。
- 关闭 VS Code 时不保证恢复到关闭前输入法状态，可能停留在英文。
- 语法判断是轻量解析，复杂场景（如 C++ 原始字符串等）可能存在误判。
- 每次光标/文档变化都会重新扫描到光标位置，超大文件下可能有性能开销。

## 3. 实现原理（简要）

- 监听 VS Code 事件：活动编辑器变化、光标移动、文档变更、配置变更。
- 对事件做短延时防抖（`50ms`），避免高频触发时重复执行。
- 在更新时判断当前光标是否位于注释或双引号字符串中。
- 根据判断结果确定目标模式（中文/英文），仅在模式变化时执行切换命令。
- 切换通过 `execFile` 调用 `im-select.exe`，并传入配置的输入法编码参数。

